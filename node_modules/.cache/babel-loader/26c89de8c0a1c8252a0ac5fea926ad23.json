{"ast":null,"code":"var _jsxFileName = \"/home/saahil/Desktop/SE-Project/cometchatsdk/my-app/src/Agent.js\";\nimport React, { Component } from 'react';\nimport { Widget, addResponseMessage, addUserMessage, dropMessages } from 'react-chat-widget'; //import config from './config';\n\nimport 'react-chat-widget/lib/styles.css'; //to get the style of it \n\nvar request = require(\"request\");\n\nconst appid = '11117c8bb5adb87';\nconst apikey = '3244e1da16d747391d68a8e5c6a75a25ab8458c1';\nconst agentUID = 'agent-trial-11';\nconst customerUID = 'client-trial-1';\n\nclass Agent extends Component {\n  constructor(...args) {\n    super(...args);\n\n    this.handleNewUserMessage = newMessage => {\n      console.log(\"New message incomig! \".concat(newMessage)); // Now send the message throught the backend API\n\n      console.log(newMessage);\n      this.sendmessage(agentUID, customerUID, newMessage);\n      var result = dropMessages(); // create listener\n\n      console.log(\"there is a not return type in dropmessage\"); //addUserMessage(\"everything is perfect now\")\n\n      setTimeout(this.getconversation(agentUID, customerUID, 1), 500); //addUserMessage(newMessage);\n      //this.getconversation(agentUID,customerUID);\n    };\n\n    this.getconversation = function (agentUID, customerUID, flag = 0) {\n      var options = {\n        method: 'GET',\n        url: 'https://api-eu.cometchat.io/v2.0/users/' + String(agentUID) + '/users/' + String(customerUID) + '/messages',\n        //qs: {unread: 'true', undelivered: 'true'},\n        headers: {\n          appid: '11117c8bb5adb87',\n          apikey: '3244e1da16d747391d68a8e5c6a75a25ab8458c1',\n          'content-type': 'application/json',\n          accept: 'application/json'\n        }\n      };\n      request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n        var j = JSON.parse(response[\"body\"]);\n        console.log(j);\n        j = j[\"data\"];\n\n        if (j.length === 0) {\n          return;\n        }\n\n        var x;\n        console.log(\"getconversation\", j);\n\n        if (flag) {\n          for (x in j) {\n            //console.log(\"x in j\",j[x].data.text);\n            if (j[x].sender === customerUID) {\n              addResponseMessage(String(j[x].data.text));\n            } else {\n              addUserMessage(String(j[x].data.text));\n            }\n          }\n        }\n\n        console.log(\"obj\", j[0].data.text); //addUserMessage(String(j[j.length-1].data.text))\n\n        console.log(typeof j);\n      });\n    };\n\n    this.sendmessage = function (agentUID, customerUID, newMessage) {\n      var options = {\n        method: 'POST',\n        url: 'https://api-eu.cometchat.io/v2.0/users/' + String(agentUID) + '/messages',\n        headers: {\n          appid: '11117c8bb5adb87',\n          apikey: '3244e1da16d747391d68a8e5c6a75a25ab8458c1',\n          'content-type': 'application/json',\n          accept: 'application/json'\n        },\n        body: '{\"receiver\":' + '\"' + String(customerUID) + '\"' + ',\"receiverType\":\"user\",\"category\":\"message\",\"type\":\"text\",\"data\":{\"text\":' + '\"' + String(newMessage) + '\"' + '}}'\n      };\n      request(options, function (error, response, body) {\n        if (error) throw new Error(error);\n        console.log(\"send message\", body);\n        return;\n      });\n    };\n  }\n\n  componentDidMount() {\n    let uid = localStorage.getItem(customerUID);\n    let uidb = localStorage.getItem(agentUID);\n    var flag = 1;\n    console.log(\"your an agent\");\n    this.getconversation(agentUID, customerUID, flag);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"App\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 27\n      },\n      __self: this\n    }, React.createElement(Widget, {\n      handleNewUserMessage: this.handleNewUserMessage,\n      title: \"Client-Chat\",\n      subtitle: \"\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 28\n      },\n      __self: this\n    }));\n  }\n\n}\n\nexport default Agent;","map":{"version":3,"sources":["/home/saahil/Desktop/SE-Project/cometchatsdk/my-app/src/Agent.js"],"names":["React","Component","Widget","addResponseMessage","addUserMessage","dropMessages","request","require","appid","apikey","agentUID","customerUID","Agent","handleNewUserMessage","newMessage","console","log","sendmessage","result","setTimeout","getconversation","flag","options","method","url","String","headers","accept","error","response","body","Error","j","JSON","parse","length","x","sender","data","text","componentDidMount","uid","localStorage","getItem","uidb","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,QAAiC,OAAjC;AACA,SAASC,MAAT,EAAiBC,kBAAjB,EAAqCC,cAArC,EAAqDC,YAArD,QAAyE,mBAAzE,C,CACA;;AACA,OAAO,kCAAP,C,CAA0C;;AAE1C,IAAIC,OAAO,GAAGC,OAAO,CAAC,SAAD,CAArB;;AAEA,MAAMC,KAAK,GAAC,iBAAZ;AACA,MAAMC,MAAM,GAAC,0CAAb;AAGA,MAAMC,QAAQ,GAAG,gBAAjB;AACA,MAAMC,WAAW,GAAC,gBAAlB;;AAEA,MAAMC,KAAN,SAAoBX,SAApB,CAA8B;AAAA;AAAA;;AAAA,SAuBxBY,oBAvBwB,GAuBAC,UAAD,IAAgB;AAErCC,MAAAA,OAAO,CAACC,GAAR,gCAAoCF,UAApC,GAFqC,CAGrC;;AACAC,MAAAA,OAAO,CAACC,GAAR,CAAYF,UAAZ;AACC,WAAKG,WAAL,CAAiBP,QAAjB,EAA0BC,WAA1B,EAAsCG,UAAtC;AACD,UAAII,MAAM,GAACb,YAAY,EAAvB,CANqC,CAOrC;;AACAU,MAAAA,OAAO,CAACC,GAAR,CAAY,2CAAZ,EARqC,CASvC;;AACAG,MAAAA,UAAU,CAAC,KAAKC,eAAL,CAAqBV,QAArB,EAA8BC,WAA9B,EAA0C,CAA1C,CAAD,EAA8C,GAA9C,CAAV,CAVuC,CAWvC;AACE;AAGD,KAtCuB;;AAAA,SAuCxBS,eAvCwB,GAuCR,UAAUV,QAAV,EAAmBC,WAAnB,EAA+BU,IAAI,GAAC,CAApC,EAAuC;AACrD,UAAIC,OAAO,GAAG;AACZC,QAAAA,MAAM,EAAE,KADI;AAEZC,QAAAA,GAAG,EAAE,4CAA0CC,MAAM,CAACf,QAAD,CAAhD,GAA2D,SAA3D,GAAqEe,MAAM,CAACd,WAAD,CAA3E,GAAyF,WAFlF;AAGZ;AACAe,QAAAA,OAAO,EAAE;AACPlB,UAAAA,KAAK,EAAE,iBADA;AAEPC,UAAAA,MAAM,EAAE,0CAFD;AAGP,0BAAgB,kBAHT;AAIPkB,UAAAA,MAAM,EAAE;AAJD;AAJG,OAAd;AAYArB,MAAAA,OAAO,CAACgB,OAAD,EAAU,UAAUM,KAAV,EAAiBC,QAAjB,EAA2BC,IAA3B,EAAiC;AAChD,YAAIF,KAAJ,EAAW,MAAM,IAAIG,KAAJ,CAAUH,KAAV,CAAN;AACX,YAAII,CAAC,GAACC,IAAI,CAACC,KAAL,CAAWL,QAAQ,CAAC,MAAD,CAAnB,CAAN;AACAd,QAAAA,OAAO,CAACC,GAAR,CAAYgB,CAAZ;AACAA,QAAAA,CAAC,GAACA,CAAC,CAAC,MAAD,CAAH;;AACA,YAAGA,CAAC,CAACG,MAAF,KAAW,CAAd,EAAgB;AAAC;AAAQ;;AACzB,YAAIC,CAAJ;AACArB,QAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA8BgB,CAA9B;;AACA,YAAGX,IAAH,EAAQ;AACR,eAAIe,CAAJ,IAASJ,CAAT,EAAW;AACT;AACA,gBAAGA,CAAC,CAACI,CAAD,CAAD,CAAKC,MAAL,KAAc1B,WAAjB,EAA6B;AAC7BR,cAAAA,kBAAkB,CAACsB,MAAM,CAACO,CAAC,CAACI,CAAD,CAAD,CAAKE,IAAL,CAAUC,IAAX,CAAP,CAAlB;AAA4C,aAD5C,MAEI;AACFnC,cAAAA,cAAc,CAAEqB,MAAM,CAACO,CAAC,CAACI,CAAD,CAAD,CAAKE,IAAL,CAAUC,IAAX,CAAR,CAAd;AACD;AACF;AAAC;;AAEFxB,QAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAkBgB,CAAC,CAAC,CAAD,CAAD,CAAKM,IAAL,CAAUC,IAA5B,EAlBgD,CAmB/C;;AACDxB,QAAAA,OAAO,CAACC,GAAR,CAAY,OAAOgB,CAAnB;AACD,OArBM,CAAP;AAsBD,KA1EuB;;AAAA,SA2ExBf,WA3EwB,GA2EZ,UAAUP,QAAV,EAAmBC,WAAnB,EAA+BG,UAA/B,EAA2C;AAC3D,UAAIQ,OAAO,GAAG;AACZC,QAAAA,MAAM,EAAE,MADI;AAEZC,QAAAA,GAAG,EAAE,4CAA0CC,MAAM,CAACf,QAAD,CAAhD,GAA2D,WAFpD;AAGZgB,QAAAA,OAAO,EAAE;AACPlB,UAAAA,KAAK,EAAE,iBADA;AAEPC,UAAAA,MAAM,EAAE,0CAFD;AAGP,0BAAgB,kBAHT;AAIPkB,UAAAA,MAAM,EAAE;AAJD,SAHG;AASZG,QAAAA,IAAI,EAAE,iBAAe,GAAf,GAAmBL,MAAM,CAACd,WAAD,CAAzB,GAAuC,GAAvC,GAA2C,2EAA3C,GAAuH,GAAvH,GAA2Hc,MAAM,CAACX,UAAD,CAAjI,GAA8I,GAA9I,GAAkJ;AAT5I,OAAd;AAYAR,MAAAA,OAAO,CAACgB,OAAD,EAAU,UAAUM,KAAV,EAAiBC,QAAjB,EAA2BC,IAA3B,EAAiC;AAChD,YAAIF,KAAJ,EAAW,MAAM,IAAIG,KAAJ,CAAUH,KAAV,CAAN;AACXb,QAAAA,OAAO,CAACC,GAAR,CAAY,cAAZ,EAA2Bc,IAA3B;AACA;AAED,OALM,CAAP;AAMO,KA9FqB;AAAA;;AAE1BU,EAAAA,iBAAiB,GAAG;AAEhB,QAAIC,GAAG,GAAGC,YAAY,CAACC,OAAb,CAAqBhC,WAArB,CAAV;AACA,QAAIiC,IAAI,GAACF,YAAY,CAACC,OAAb,CAAqBjC,QAArB,CAAT;AACA,QAAIW,IAAI,GAAC,CAAT;AACAN,IAAAA,OAAO,CAACC,GAAR,CAAY,eAAZ;AACA,SAAKI,eAAL,CAAqBV,QAArB,EAA8BC,WAA9B,EAA0CU,IAA1C;AACD;;AACDwB,EAAAA,MAAM,GAAG;AACP,WACE;AAAK,MAAA,SAAS,EAAC,KAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACE,oBAAC,MAAD;AAEE,MAAA,oBAAoB,EAAE,KAAKhC,oBAF7B;AAGE,MAAA,KAAK,EAAC,aAHR;AAIE,MAAA,QAAQ,EAAC,EAJX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MADF,CADF;AAWD;;AAtBuB;;AAgG9B,eAAeD,KAAf","sourcesContent":["import React, { Component } from 'react';\nimport { Widget, addResponseMessage, addUserMessage, dropMessages } from 'react-chat-widget';\n//import config from './config';\nimport 'react-chat-widget/lib/styles.css';//to get the style of it \n\nvar request = require(\"request\");\n\nconst appid='11117c8bb5adb87';\nconst apikey='3244e1da16d747391d68a8e5c6a75a25ab8458c1';\n\n\nconst agentUID = 'agent-trial-11';\nconst customerUID='client-trial-1';\n\nclass Agent extends Component {\n\n    componentDidMount() {\n    \n        let uid = localStorage.getItem(customerUID);\n        let uidb=localStorage.getItem(agentUID);\n        var flag=1;\n        console.log(\"your an agent\");\n        this.getconversation(agentUID,customerUID,flag) ;     \n      }\n      render() {\n        return (\n          <div className=\"App\">\n            <Widget\n\n              handleNewUserMessage={this.handleNewUserMessage}\n              title='Client-Chat'\n              subtitle=''\n    \n            />\n          </div>\n        );\n      }\n      handleNewUserMessage = (newMessage) => {\n    \n        console.log(`New message incomig! ${newMessage}`);\n        // Now send the message throught the backend API\n        console.log(newMessage);\n         this.sendmessage(agentUID,customerUID,newMessage);\n        var result=dropMessages();\n        // create listener\n        console.log(\"there is a not return type in dropmessage\")\n      //addUserMessage(\"everything is perfect now\")\n      setTimeout(this.getconversation(agentUID,customerUID,1),500);\n      //addUserMessage(newMessage);\n        //this.getconversation(agentUID,customerUID);\n        \n    \n      };\n      getconversation=function (agentUID,customerUID,flag=0) {\n        var options = {\n          method: 'GET',\n          url: 'https://api-eu.cometchat.io/v2.0/users/'+String(agentUID)+'/users/'+String(customerUID)+'/messages',\n          //qs: {unread: 'true', undelivered: 'true'},\n          headers: {\n            appid: '11117c8bb5adb87',\n            apikey: '3244e1da16d747391d68a8e5c6a75a25ab8458c1',\n            'content-type': 'application/json',\n            accept: 'application/json'\n          }\n        };\n        \n        request(options, function (error, response, body) {\n          if (error) throw new Error(error);    \n          var j=JSON.parse(response[\"body\"])\n          console.log(j)\n          j=j[\"data\"]\n          if(j.length===0){return }\n          var x\n          console.log(\"getconversation\",j)\n          if(flag){\n          for(x in j){\n            //console.log(\"x in j\",j[x].data.text);\n            if(j[x].sender===customerUID){\n            addResponseMessage(String(j[x].data.text));}\n            else{\n              addUserMessage((String(j[x].data.text)))\n            }\n          }}\n      \n          console.log(\"obj\",j[0].data.text);\n           //addUserMessage(String(j[j.length-1].data.text))\n          console.log(typeof(j))\n        });\n      }\n      sendmessage=function (agentUID,customerUID,newMessage) {\n  var options = {\n    method: 'POST',\n    url: 'https://api-eu.cometchat.io/v2.0/users/'+String(agentUID)+'/messages',\n    headers: {\n      appid: '11117c8bb5adb87',\n      apikey: '3244e1da16d747391d68a8e5c6a75a25ab8458c1',\n      'content-type': 'application/json',\n      accept: 'application/json'\n    },\n    body: '{\"receiver\":'+'\"'+String(customerUID)+'\"'+',\"receiverType\":\"user\",\"category\":\"message\",\"type\":\"text\",\"data\":{\"text\":'+'\"'+String(newMessage)+'\"'+'}}'\n};\n  \n  request(options, function (error, response, body) {\n    if (error) throw new Error(error);\n    console.log(\"send message\",body);\n    return ;\n    \n  });\n        }      \n  }\nexport default Agent;\n"]},"metadata":{},"sourceType":"module"}